#!/bin/bash
# BLOCKS direct commits in forge-core when used as subdirectory
# Installed in forge-core/.git/hooks/pre-commit by make dev-core
#
# This hook prevents the common mistake of committing directly in forge-core
# when dev-core mode is active. The correct workflow is to commit from
# automagik-forge root, where the pre-commit hook will auto-sync changes.

set -e

RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
CYAN='\033[0;36m'
NC='\033[0m'

echo ""
echo -e "${RED}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${RED}â•‘  ğŸ›‘ COMMIT BLOCKED: Do NOT commit directly in forge-core    â•‘${NC}"
echo -e "${RED}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo -e "This forge-core is a development subdirectory of automagik-forge."
echo -e "Direct commits here bypass the automated sync workflow."
echo ""
echo -e "${CYAN}CORRECT WORKFLOW:${NC}"
echo -e "  1. ${GREEN}cd ..${NC}                    # Back to automagik-forge root"
echo -e "  2. ${GREEN}git add .${NC}                # Stage your changes"
echo -e "  3. ${GREEN}git commit -m 'message'${NC}  # Hooks auto-sync forge-core"
echo ""
echo -e "${YELLOW}What happens when you commit correctly:${NC}"
echo -e "  - pre-commit hook stages forge-core changes"
echo -e "  - prepare-commit-msg hook commits forge-core with same message"
echo -e "  - Both repos stay perfectly in sync"
echo ""
echo -e "${YELLOW}If you REALLY need to commit independently:${NC}"
echo -e "  1. Run ${GREEN}make dev-core-off${NC} in automagik-forge"
echo -e "  2. Work in a separate forge-core clone"
echo -e "  3. Follow the twin PR workflow (see docs/DUAL_REPO_WORKFLOW.md)"
echo ""
exit 1
